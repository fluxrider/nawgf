<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8" />
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1" />
<title>Demo</title>
<style>
#my_canvas {
  width: 510px; height: 270px;
  image-rendering: pixelated;
  image-rendering: crisp-edges;
}
</style>
<script>
is_fill = false;
key_held = false;

function my_onload() {
  let canvas = document.getElementById("my_canvas");
  canvas.addEventListener('fullscreenchange', (event) => {
    // on enter fullscreen
    if(document.fullscreenElement) {
      canvas.style.border = 0;
    }
    // on exit fullscreen
    else {
      canvas.style.border = is_fill? 0 : "1px solid rgb(255, 0, 0)";
    }
  });
}

function my_fullscreen() {
  //alert(document.fullscreenEnabled);
  let canvas = document.getElementById("my_canvas");
  canvas.requestFullscreen().catch(err => {
    alert("Error attempting to enable full-screen mode: " + err.message + " " + err.name);
  });
}
function my_fill_toggle() {
  let canvas = document.getElementById("my_canvas");
  // unfill window
  if(is_fill) {
    canvas.style.width = "510px";
    canvas.style.height = "270px";
    let is_fullscreen = document.fullscreenElement != null;
    canvas.style.border = is_fullscreen? 0 : "1px solid rgb(255, 0, 0)";
    // reset margin and padding
    document.body.style.margin = ""; document.body.style.padding = "";
  }
  // fill window
  else {
    canvas.style.border = 0;
    document.body.style.margin = 0; document.body.style.padding = 0;
    my_fill();
  }
  is_fill = !is_fill;
}
function my_fill() {
  let canvas = document.getElementById("my_canvas");
  canvas.style.width = "100vw";
  canvas.style.height = "100vh";

  // respect aspect ratio of canvas buffer
  let W = canvas.clientWidth; H = canvas.clientHeight;
  let w = canvas.width; h = canvas.height;
  let a = w / h;
  let A = W / H;
  let offsetX = 0;
  let offsetY = 0;
  let aspectW = W;
  let aspectH = H;
  // top/down black bars
  if (a / A > 1) {
    aspectH = W * h / w;
    offsetY = (H - aspectH) / 2;
  }
  // left/right black bars
  else {
    aspectW = H * w / h;
    offsetX = (W - aspectW) / 2;
  }
  // set
  canvas.style.width = (aspectW / W * 100) + "vw";
  canvas.style.height = (aspectH / H * 100) + "vh";
  // use to work perfectly with a square 100x100 canvas, but has sliders when I use 510x270
}

frame = 0;
t0 = null;
function my_render(t1) {
  let canvas = document.getElementById("my_canvas");
  let w = canvas.width;
  let h = canvas.height;
  let g = canvas.getContext("2d");
  if(!t0) t0 = t1;
  let dt = (t1 - t0) / 1000;

  // Create gradient
  let grd = g.createLinearGradient(0, 0, w, 0);
  grd.addColorStop(0, "red");
  grd.addColorStop(1, "white");

  // Fill with gradient
  g.fillStyle = 'green';
  g.fillRect(0, 0, w, h);
  g.fillStyle = grd;
  g.fillRect(10, 10, w - 20, h - 20);
  
  //var image = new Image();
  //image.onload = function () {
  //  g.drawImage(image, 0, 0);
  //}
  //image.src = 'cat.png';

  g.strokeStyle = "blue";
  g.strokeText("key held: " + key_held, 30, 30);
  g.strokeText("frame: " + frame++, 30, 60);
  g.strokeText("t: " + t1, 30, 90);
  g.strokeText(`dt: ${dt.toFixed(3)} (${(1/dt).toFixed(1)})`, 30, 120);

  requestAnimationFrame(my_render);
  t0 = t1;
}

function my_window_resize() {
  let is_fullscreen = document.fullscreenElement != null;
  if(is_fullscreen) {
  } else if(is_fill) {
    my_fill();
  }
}
window.addEventListener("resize", my_window_resize);

function my_keydown(event) {
  if(event.keyCode == 39) {
    key_held = true;
    event.preventDefault();
  }
}
function my_keyup(event) {
  if(event.keyCode == 39) {
    key_held = false;
    event.preventDefault();
  }
}

document.addEventListener('keydown', my_keydown);
document.addEventListener('keyup', my_keyup);
</script>
</head><body onload="my_onload();">
<canvas id="my_canvas" width="510" height="270" style="border:1px solid #FF0000;"/></canvas>
<p onclick="requestAnimationFrame(my_render);">render</p>
<p onclick="my_fullscreen();">fullscreen</p>
<p onclick="my_fill_toggle();">fill</p>
</body></html>
